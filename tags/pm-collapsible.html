<pm-collapsible>
  <div class={ opts.outerclass } id="collapsible_container" style="height: { containerHeight }px; { depStyle }">
    <div class={ opts.innerclass } id="collapsible_content" style="opacity: { contentOpacity }">
      <yield/>
    </div>
  </div>
  <style scoped>
    #collapsible_container {
      transition: height 0.2s linear;
      /*background-color: #AAA;*/
    }
    #collapsible_content {
      transition: opacity 0.2s linear;
    }
  </style>
  <script>
    var self = this;
    self.expanded = null;

    var doCollapse = function() {
      console.log("doCollapse() called");
      self.expanded = false;
      self.containerHeight = 0;
      self.contentOpacity = 0;
      setTimeout(function() {
        self.depStyle = "padding: 0px;";
        self.update();
      }, 200);
      self.update();
    }
    var doExpand = function() {
      console.log("doReveal() called");
      self.expanded = true;
      self.depStyle = "";
      var contentHeight = self.collapsible_content.offsetHeight;
      if (opts.height != null) {
        self.containerHeight = opts.height;
      } else if (opts.vpadding != null) {
        self.containerHeight = contentHeight + parseInt(opts.vpadding);
      } else {
        self.containerHeight = contentHeight;
      }
      self.contentOpacity = 100;
      self.update();
    }

    self.on("updated", function() {
      console.log("pm-collapsible was updated.");
      console.log("I am " + self.expanded + " -- I need to be " + opts.expanded);
      if((self.expanded == true || self.expanded == null) && opts.expanded == false) {
        console.log("collapsing from update hook")
        doCollapse();
      } else if ((self.expanded == false || self.expanded == null) && opts.expanded == true) {
        console.log("expanding from update hook")
        doExpand();
      }
    });

    self.on("mount", function() {
      self.update();
    });

    // self.parent.on("toggle_collapse", function(val) {
    //   if (val == null) {
    //     if (self.collapsed) {
    //       doReveal();
    //     } else {
    //       doCollapse();
    //     }
    //   } else if (val == true) {
    //     doCollapse();
    //   } else if (val == false) {
    //     doReveal();
    //   }
    // });
  </script>
</pm-collapsible>
